#!/usr/bin/env ruby

require 'optparse'
require 'methadone'
require 'compaa'

class App
  include Methadone::Main
  include Methadone::CLILogging

  main do
    Compaa::DifferenceImage.all.each do |difference_image|
      puts "Comparing: #{difference_image.path}"
      puts "Would you like to make this the reference image?"

      difference_image.create_reference_image if screenshot_approved?
    end

    Compaa::GeneratedImage.all.each do |generated_image|
      next if generated_image.has_reference_image?

      puts "Approving: #{generated_image.path}"
      puts "Would you like to make this the reference image?"

      generated_image.create_reference_image if screenshot_approved?
    end
  end

  def self.screenshot_approved?
    STDIN.gets.chomp.downcase.start_with? 'y'
  end

  version Compaa::VERSION

  use_log_level_option

  go!
end
